import{F as Z,l as A,bc as fe,m as k,a as f,j as e,B as n,aQ as ge,c as L,C as xe,bF as be,aM as ye,aL as G,bG as je,o as U,T as J,aN as Se,bW as K,b4 as S,bX as we}from"./index-BcecFl1Z.js";import{S as ee,F as ae,C as Ie,a as Te,b as Fe}from"./SettingsHeader-CQCGcilU.js";import{S as Ee,w as Q,j as R}from"./tabsFieldData-D3yi5tQA.js";import{d as W,w as De}from"./index-Cj_J1U08.js";import{E as w,I as te}from"./ImageDropzone--TLyPGNJ.js";import{E as We}from"./Editor-CmyFx_XS.js";import{u as Ae}from"./formik.esm-BY6TlLsT.js";import{r as Ce}from"./HelperFunctions-DWwEU7oF.js";import{P as Pe}from"./PreviewModal-CnjfHEFi.js";import{W as Oe}from"./WhitepaperPreview-CnBwtEbE.js";import{c as ve,b as q,d as N,a as qe,e as X}from"./index.esm-D49cUJoZ.js";import"./Materialcons-Die1CzwC.js";import"./Search-DNIIj65s.js";import"./Tooltip-Ekydzdoo.js";import"./Checkbox-C1UzI-gw.js";import"./CustomButtons-2kTcvzb6.js";import"./Tabs-DUTfjCyQ.js";import"./pdf-container-img-ChRV-rEw.js";import"./Navbar-5U6_2lyq.js";import"./ListItemText-DYwIz_-f.js";const Ne="/assets/whitepaper-tumbnail-CINGzT-O.svg",Le="/assets/whitepaper-detail-DKjsT9L0.svg",Ve=({formik:s,isEdit:I,status:C})=>{const{state:h}=Z(),{tagsFilteredData:b}=A(fe),{companyFilteredData:j}=A(k),[P,O]=f.useState(!1);return f.useEffect(()=>{h&&(h!=null&&h.from)&&(h==null?void 0:h.from)==="home"&&O(!0)},[h]),e.jsx(ee,{children:e.jsxs(n,{display:"flex",sx:{maxWidth:"755px",minHeight:"70vh",mx:"auto"},children:[e.jsx(n,{width:"60px"}),e.jsxs(n,{sx:{flex:1},children:[e.jsx(ae,{title:"Overview",imageSrc:Ne,imgHeight:"141",description:"Project title and tags and images along with the image caption - will be showcased as such"}),e.jsxs(n,{mt:"44px",id:"whitepaperTitle",children:[e.jsx(ge,{value:s.values.whitepaperTitle||"",onChange:g=>{var x;s.setFieldValue("whitepaperTitle",(x=g==null?void 0:g.target)==null?void 0:x.value)},maxLength:100,placeholder:"White Paper title here..",border:"none",fontSize:"24px",placeholderFontSize:"24px",placeholderFontWeight:400,placeholderFontFamily:"Noto Serif",borderBottom:`1px solid ${L.gray2}`,sx:{width:"100%"},name:"whitepaperTitle"}),s.touched.whitepaperTitle&&s.errors.whitepaperTitle&&e.jsx(n,{children:e.jsx(w,{message:s.errors.whitepaperTitle})})]}),e.jsxs(n,{mt:"32px",id:"tags",children:[e.jsx(Ie,{placeholder:"Add tags",formik:s,fieldName:"tags",options:b}),s.touched.tags&&s.errors.tags&&e.jsx(n,{children:e.jsx(w,{message:s.errors.tags})})]}),e.jsxs(n,{mt:"32px",id:"companyId",children:[e.jsx(xe,{label:"Select Company",disabled:I?C!==0:!P,options:j,value:s.values.companyId,onChange:g=>{var x;s.setFieldValue("companyId",(x=g==null?void 0:g.target)==null?void 0:x.value)},sx:{"& .MuiOutlinedInput-root":{height:"44px"}}}),s.touched.companyId&&s.errors.companyId&&e.jsx(n,{children:e.jsx(w,{message:s.errors.companyId})})]}),e.jsxs(n,{sx:{mt:"180px"},id:"thumbnail",children:[e.jsx(te,{formik:s,fieldName:"thumbnail",imgLimit:1,title:"Add Thumbnail"}),s.touched.thumbnail&&s.errors.thumbnail&&e.jsx(n,{children:e.jsx(w,{message:s.errors.thumbnail})})]})]}),e.jsx(n,{width:"60px"})]})})},He=({formik:s})=>e.jsx(ee,{children:e.jsxs(n,{display:"flex",sx:{maxWidth:"755px",minHeight:"70vh",mx:"auto"},children:[e.jsxs(n,{sx:{flex:1},children:[e.jsx(n,{sx:{ml:"60px"},children:e.jsx(ae,{title:"Summary",imageSrc:Le,imgHeight:"141",description:"Project title and tags and images along with the image caption - will be showcased as such"})}),e.jsxs(n,{mt:"36px",id:"summary",children:[e.jsx(We,{formik:s,fieldName:"summary",placeholder:"Type Summary here..."}),s.touched.summary&&s.errors.summary&&e.jsx(n,{sx:{ml:"60px"},children:e.jsx(w,{message:s.errors.summary})})]}),e.jsxs(n,{sx:{ml:"60px",mt:"180px"},id:"pdf",children:[e.jsx(te,{formik:s,fieldName:"pdf",allowOnly:"pdf",imgLimit:1}),s.touched.pdf&&s.errors.pdf&&e.jsx(n,{children:e.jsx(w,{message:s.errors.pdf})})]})]}),e.jsx(n,{width:"60px"})]})}),Y=ve({whitepaperTitle:q().required("Whitepaper title is required").min(3,"Whitepaper title should be at least 3 characters long").max(100,"Whitepaper title should be less than 100 characters long"),tags:N().min(1,"At least one tag is required").max(7,"A maximum of 7 tags is allowed").of(q().required("Tag is required")),companyId:qe().test({name:"companyId",test:function(s){return s===-1?this.createError({message:"Company is required"}):!0}}),thumbnail:N().min(1,"At least one thumbnail is required").of(X().required("thumbnail is required")),summary:q().test({name:"summary",test:function(s){if(s){if(JSON.parse(s).blocks.length===0)return this.createError({message:"Summary is required"})}else return this.createError({message:"Summary is required"});return!0}}),pdf:N().min(1,"Pdf is required").of(X().required("Pdf is required"))}),ia=()=>{var _;const{id:s}=be(),{companyId:I}=A(ye),{companyFilteredData:C}=A(k),[h,b]=G.useState(0),[j,P]=f.useState(!1),[O,g]=f.useState(!1),[x,se]=f.useState(0),[V,T]=f.useState(!1),[re,H]=f.useState(!1),{state:y}=Z(),[F,$]=f.useState(-1),[B,M]=f.useState(!1),[v,ie]=G.useState({whitepaperTitle:"",tags:[],companyId:y&&(y!=null&&y.from)&&(y==null?void 0:y.from)==="home"?-1:I,thumbnail:[],summary:"",pdf:[],isShareable:1}),ne=()=>{H(!0)},oe=()=>{H(!1)},z=(a,d)=>{b(d)},de=async(a,d)=>{var l,p;g(!0);try{const t=await Se({id:a,view:d});if(t.data.status_code===200){const r=(p=(l=t==null?void 0:t.data)==null?void 0:l.data)==null?void 0:p.data[0];if(r){let i={whitepaperTitle:r.title,companyId:r.companyId,summary:r.summary,tags:r.tags.map(m=>m.id),pdf:[],thumbnail:[],isShareable:!0};r.pdf&&r.pdf.length!=0&&(i={...i,pdf:[{file:r.pdf,name:r.pdfOriginalFilename}]}),r.bannerImage&&r.bannerImage.length>0&&(i={...i,thumbnail:[{file:r.bannerImage,name:r.bannerImageName}]}),i={...i,isShareable:r.isShareable},ie(i),se(r.status)}}}catch(t){console.log(t)}finally{g(!1)}},le=async a=>{var d,l,p,t,r,i;M(!0);try{const m=new FormData;a.thumbnail.length>0&&(m.append("thumbnail",a.thumbnail[0].file),m.append("thumbnailName",a.thumbnail[0].name)),m.append("whitepaperTitle",a.whitepaperTitle),a.tags.length>0&&a.tags.forEach((he,ue)=>{m.append(`tags[${ue}]`,he.toString())}),a.companyId!=-1&&m.append("companyId",a.companyId.toString()),m.append("summary",a.summary),a.pdf.length>0&&(m.append("pdf",a.pdf[0].file),m.append("pdfFilename",a.pdf[0].name));let u={status:W.draft};F!=-1&&(u={...u,id:F});const c=await K(m,u);((d=c==null?void 0:c.data)==null?void 0:d.status_code)===200&&(S.success("Draft Saved"),$((t=(p=(l=c==null?void 0:c.data)==null?void 0:l.data)==null?void 0:p.data)==null?void 0:t.id))}catch(m){const u=(i=(r=m==null?void 0:m.response)==null?void 0:r.data)==null?void 0:i.data;if(Array.isArray(u)){if(u.forEach(c=>{o.setFieldError(c.fieldname,c.message)}),u.length>0){const c=u[0];D({[c.fieldname]:c.message}),E({[c.fieldname]:c.message})}}else typeof u=="string"&&S.error(u)}finally{M(!1)}},pe=async a=>{var d,l,p;T(!0);try{const t=new FormData;t.append("thumbnail",a.thumbnail[0].file),t.append("thumbnailName",a.thumbnail[0].name),t.append("whitepaperTitle",a.whitepaperTitle),a.tags.forEach((m,u)=>{t.append(`tags[${u}]`,m.toString())}),t.append("companyId",a.companyId.toString()),t.append("summary",a.summary),t.append("pdf",a.pdf[0].file),t.append("pdfFilename",a.pdf[0].name);let r={status:W.create};F!=-1&&(r={...r,id:F});const i=await K(t,r);((d=i==null?void 0:i.data)==null?void 0:d.status_code)===200&&(S.success("Whitepaper Added"),b(0),o.resetForm())}catch(t){const r=(p=(l=t==null?void 0:t.response)==null?void 0:l.data)==null?void 0:p.data;if(Array.isArray(r)){if(r.forEach(i=>{o.setFieldError(i.fieldname,i.message)}),r.length>0){const i=r[0];D({[i.fieldname]:i.message}),E({[i.fieldname]:i.message})}}else typeof r=="string"&&S.error(r)}finally{T(!1)}},me=async a=>{var d,l,p;if(s&&btoa(s)){T(!0);try{const t=new FormData;t.append("thumbnail",a.thumbnail[0].file),t.append("thumbnailName",a.thumbnail[0].name),t.append("whitepaperTitle",a.whitepaperTitle),a.tags.forEach((i,m)=>{t.append(`tags[${m}]`,i.toString())}),t.append("companyId",a.companyId.toString()),t.append("summary",a.summary),t.append("pdf",a.pdf[0].file),t.append("pdfFilename",a.pdf[0].name),t.append("isShareable",a.isShareable.toString());const r=await we(t,atob(s),{status:W.published});((d=r==null?void 0:r.data)==null?void 0:d.status_code)===200&&(S.success("Whitepaper Updated"),b(0),o.resetForm())}catch(t){const r=(p=(l=t==null?void 0:t.response)==null?void 0:l.data)==null?void 0:p.data;if(Array.isArray(r)){if(r.forEach(i=>{o.setFieldError(i.fieldname,i.message)}),r.length>0){const i=r[0];D({[i.fieldname]:i.message}),E({[i.fieldname]:i.message})}}else typeof r=="string"&&S.error(r)}finally{T(!1)}}},o=Ae({initialValues:v,validationSchema:Y,onSubmit:a=>{j?me(a):pe(a)}}),E=a=>{const d=Object.keys(a);if(d.length>0){const l=d[0];let p=0;Q.includes(l)?p=0:R.includes(l)&&(p=1),p!==void 0&&p!==h&&z(null,p),setTimeout(()=>{const t=document.getElementById(l);t&&(t.scrollIntoView({behavior:"smooth",block:"center"}),t.focus())},300)}},D=a=>{const d=Ce(a,Y);if(Object.keys(d).length>0){const l=Object.keys(d)[0];Q.includes(l)?b(0):R.includes(l)&&b(1)}},ce=async a=>{a.preventDefault();const d=await o.validateForm();o.setTouched(Object.keys(o.initialValues).reduce((l,p)=>({...l,[p]:!0}),{})),Object.keys(d).length?(D(d),E(d)):o.handleSubmit()};return f.useEffect(()=>{s&&atob(s)&&(P(!0),de(parseInt(atob(s)),1),$(parseInt(atob(s))))},[s]),f.useEffect(()=>{o.resetForm({values:v})},[v]),e.jsxs(n,{bgcolor:L.white2,borderTop:"1px solid white",children:[e.jsx(Te,{}),e.jsx(Pe,{title:o.values.whitepaperTitle,open:re,handleClose:oe,children:e.jsx(Oe,{previewData:o.values})}),(V||O||B)&&e.jsx(je,{}),e.jsx("form",{onSubmit:ce,children:e.jsxs(n,{sx:{...U.initialMainComponet,...U.cmsWrapperCss,mx:"auto",minHeight:"100vh"},children:[e.jsx(n,{mb:2.6,children:e.jsx(Fe,{update:j,loading:V,status:x,saveAsDraftLoading:B,isSharable:o.values.isShareable,handleIsShareable:a=>{o.setFieldValue("isShareable",a)},disableSaveAsDraft:j?x!==W.published:!0,handleSaveAsDraft:()=>{o.setFieldTouched("whitepaperTitle",!0),o.setFieldTouched("companyId",!0),le(o.values)},handlePreview:ne,title:e.jsx(n,{mb:{md:.5},children:e.jsxs(J,{variant:"h5",fontFamily:"Chivo",fontWeight:400,children:["White Paper ",o.values.companyId!==-1&&"@",e.jsxs(J,{component:"span",variant:"h4",fontWeight:700,sx:{color:L.orange1,textTransform:"capitalize"},children:[" ",o.values.companyId!==-1&&(((_=C.find(a=>a.id==o.values.companyId))==null?void 0:_.name)||"")]})," "]})})})}),e.jsx(Ee,{tabsData:De,handleChange:z,value:h}),h===0&&e.jsx(Ve,{formik:o,isEdit:j,status:x}),h===1&&e.jsx(He,{formik:o})]})})]})};export{ia as default};
